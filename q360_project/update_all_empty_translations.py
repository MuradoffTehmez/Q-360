#!/usr/bin/env python3
"""
Script to specifically update the django.po file with English translations 
for ALL empty msgstr entries, including multiline msgid entries.
"""

import re


def get_english_translation(azeri_text):
    """
    Returns English translation for the provided Azerbaijani text.
    """
    translations = {
        "Rol Məlumatları": "Role Information",
        "İcazələr": "Permissions",
        "Tarixlər": "Dates",
        "Şəxsi Məlumatlar": "Personal Information",
        "Təşkilati Məlumatlar": "Organizational Information",
        "Statistika": "Statistics",
        "İstifadəçi": "User",
        "Peşəkar Məlumatlar": "Professional Information",
        "Əlaqə Məlumatları": "Contact Information",
        "Sistem Tənzimləmələri": "System Settings",
        "Metadata": "Metadata",
        "Rol Adı": "Role Name",
        "Göstəriləcək Ad": "Display Name",
        "Təsvir": "Description",
        "Yaradılma Tarixi": "Creation Date",
        "Yenilənmə Tarixi": "Update Date",
        "Rol": "Role",
        "Rollar": "Roles",
        "Şöbə": "Department",
        "Vəzifə": "Position",
        "Ata adı": "Patronymic",
        "Telefon": "Phone",
        "İşçi ID": "Employee ID",
        "Profil Şəkli": "Profile Image",
        "Haqqında": "About",
        "Rəhbər": "Manager",
        "Aktiv": "Active",
        "Qoşulma Tarixi": "Join Date",
        "Son Giriş": "Last Login",
        "İstifadəçilər": "Users",
        "Doğum Tarixi": "Date of Birth",
        "İşə Qəbul Tarixi": "Hire Date",
        "Təhsil Səviyyəsi": "Education Level",
        "İxtisas": "Specialization",
        "İş E-poçtu": "Work Email",
        "İş Telefonu": "Work Phone",
        "Ünvan": "Address",
        "Dil Seçimi": "Language Selection",
        "E-poçt Bildirişləri": "Email Notifications",
        "SMS Bildirişləri": "SMS Notifications",
        "Profillər": "Profiles",
        "Model": "Model",
        "Dəyişikliklər": "Changes",
        "Audit Qeydi": "Audit Record",
        "Audit Qeydləri": "Audit Records",
        "Kompetensiya İdarəetməsi": "Competency Management",
        "Kompetensiya Adı": "Competency Name",
        "Kompetensiya": "Competency",
        "Kompetensiyalar": "Competencies",
        "Səviyyə Adı": "Level Name",
        "Minimum Bal": "Minimum Score",
        "Maksimum Bal": "Maximum Score",
        "Bacarıq Səviyyəsi": "Skill Level",
        "Bacarıq Səviyyələri": "Skill Levels",
        "Çəki (%)": "Weight (%)",
        "Bu kompetensiyanın vəzifə üçün əhəmiyyət dərəcəsi (1-100%)": "Importance of this competency for the position (1-100%)",
        "Tələb Olunan Səviyyə": "Required Level",
        "Məcburi": "Mandatory",
        "Bu kompetensiya vəzifə üçün məcburidirmi?": "Is this competency mandatory for the position?",
        "Vəzifə Kompetensiyası": "Position Competency",
        "Vəzifə Kompetensiyaları": "Position Competencies",
        "Çəki 1 ilə 100 arasında olmalıdır.": "Weight must be between 1 and 100.",
        "Səviyyə": "Level",
        "Cari Bal": "Current Score",
        "Qiymətləndirmədən əldə edilən son bal": "Latest score from evaluation",
        "Təsdiqləndi": "Confirmed",
        "Təsdiq Statusu": "Confirmation Status",
        "Təsdiqləyən": "Confirmed By",
        "Təsdiq Tarixi": "Confirmation Date",
        "Özünüqiymətləndirmə Balı": "Self-Assessment Score",
        "Qeydlər": "Notes",
        "İstifadəçi Bacarığı": "User Skill",
        "İstifadəçi Bacarıqları": "User Skills",
        "Əsas Məlumatlar": "Basic Information",
        "Status": "Status",
        "Rəhbərlik": "Management",
        "Ağac Strukturu": "Tree Structure",
        "Vəzifə Detalları": "Position Details",
        "Tələblər": "Requirements",
        "Təşkilat Adı": "Organization Name",
        "Qısa Ad": "Short Name",
        "Təşkilat Kodu": "Organization Code",
        "E-poçt": "Email",
        "Veb Sayt": "Website",
        "Təsis Tarixi": "Foundation Date",
        "Təşkilat": "Organization",
        "Təşkilatlar": "Organizations",
        "Üst Şöbə": "Parent Department",
        "Şöbə Adı": "Department Name",
        "Şöbə Kodu": "Department Code",
        "Yerləşmə": "Location",
        "Şöbə Rəhbəri": "Department Head",
        "Şöbələr": "Departments",
        "Vəzifə Adı": "Position Name",
        "Vəzifə Kodu": "Position Code",
        "Vəzifə Öhdəlikləri": "Position Responsibilities",
        "1=Rəhbərlik, 2=Orta menecment, 3=Əməkdaş": "1=Management, 2=Middle management, 3=Staff",
        "Hesabat Verir": "Reports To",
        "Tələb Olunan Təhsil": "Required Education",
        "Tələb Olunan Təcrübə": "Required Experience",
        "Vəzifələr": "Positions",
        "Məqsəd": "Goal",
        "Kateqoriya": "Category",
        "Hədəf Tarixi": "Target Date",
        "Təsdiq Qeydi": "Approval Note",
        "İnkişaf Məqsədi": "Development Goal",
        "İnkişaf Məqsədləri": "Development Goals",
        "Qeyd": "Note",
        "İrəliləyiş %": "Progress %",
        "Layihə": "Project",
        "İrəliləyiş Qeydi": "Progress Note",
        "İrəliləyiş Qeydləri": "Progress Notes",
        "Hədəflər": "Goals",
        "Yaradıcı və Statistika": "Creator and Statistics",
        "Sual Məlumatları": "Question Information",
        "Qiymətləndirmə": "Evaluation",
        "Parametrlər": "Parameters",
        "Kampaniya": "Campaign",
        "İştirakçılar": "Participants",
        "Tapşırıq və Sual": "Task and Question",
        "Cavab": "Answer",
        "Sentiment Analizi": "Sentiment Analysis",
        "Kampaniya və İstifadəçi": "Campaign and User",
        "Ümumi Nəticə": "Overall Result",
        "Bal Parçalanması": "Score Breakdown",
        "Kampaniya Adı": "Campaign Name",
        "Başlama Tarixi": "Start Date",
        "Bitmə Tarixi": "End Date",
        "Anonim Qiymətləndirmə": "Anonymous Evaluation",
        "Qiymətləndirənin kimliyini gizlət": "Hide evaluator's identity",
        "Özünüdəyərləndirməyə İcazə Ver": "Allow Self-Assessment",
        "Özünüdəyərləndirmə Çəkisi (%)": "Self-Assessment Weight (%)",
        "Yekun balda özünüdəyərləndirmənin çəkisi": "Weight of self-assessment in final score",
        "Rəhbər Çəkisi (%)": "Manager Weight (%)",
        "Yekun balda rəhbər qiymətləndirməsinin çəkisi": "Weight of manager evaluation in final score",
        "Həmkar Çəkisi (%)": "Peer Weight (%)",
        "Yekun balda həmkar qiymətləndirməsinin çəkisi": "Weight of peer evaluation in final score",
        "Tabelik Çəkisi (%)": "Subordinate Weight (%)",
        "Yekun balda tabelik qiymətləndirməsinin çəkisi": "Weight of subordinate evaluation in final score",
        "Hədəf Şöbələr": "Target Departments",
        "Hədəf İstifadəçilər": "Target Users",
        "Yaradan": "Creator",
        "Qiymətləndirmə Kampaniyası": "Evaluation Campaign",
        "Qiymətləndirmə Kampaniyaları": "Evaluation Campaigns",
        "Ağırlıq çəkilərinin cəmi 100% olmalıdır. ": "Sum of weight percentages must be 100%.",
        "Bitmə tarixi başlama tarixindən sonra olmalıdır.": "End date must be after start date.",
        "Kateqoriya Adı": "Category Name",
        "Sıra": "Order",
        "Sual Kateqoriyası": "Question Category",
        "Sual Kateqoriyaları": "Question Categories",
        "Sual Mətni": "Question Text",
        "Sual Növü": "Question Type",
        "Qiymətləndirmə 1-5 şkalasında aparılır": "Evaluation is performed on a 1-5 scale",
        "Suallar": "Questions",
        "Kampaniya Sualı": "Campaign Question",
        "Kampaniya Sualları": "Campaign Questions",
        "Qiymətləndirən": "Evaluator",
        "Qiymətləndirilən": "Evaluated",
        "Əlaqə Növü": "Relationship Type",
        "Başlanma Vaxtı": "Start Time",
        "Tamamlanma Vaxtı": "Completion Time",
        "Qiymətləndirmə Tapşırığı": "Evaluation Task",
        "Qiymətləndirmə Tapşırıqları": "Evaluation Tasks",
        "Tapşırıq": "Task",
        "Bal": "Score",
        "1-5 arası qiymətləndirmə balı": "Score on a 1-5 scale",
        "Bəli/Xeyr Cavabı": "Yes/No Answer",
        "Mətn Cavabı": "Text Answer",
        "Şərh": "Comment",
        "Sentiment Skoru": "Sentiment Score",
        "VADER sentiment compound skoru (-1.0 - +1.0)": "VADER sentiment compound score (-1.0 - +1.0)",
        "Sentiment Kateqoriyası": "Sentiment Category",
        "Cavablar": "Answers",
        "Ümumi Bal": "Total Score",
        "Özünüdəyərləndirmə Balı": "Self-Assessment Score",
        "Rəhbər Balı": "Manager Score",
        "Həmkar Balı": "Peer Score",
        "Tabelik Balı": "Subordinate Score",
        "Qiymətləndirən Sayı": "Number of Evaluators",
        "Tamamlanma Faizi": "Completion Percentage",
        "Yekunlaşdırılmış": "Finalized",
        "Yekunlaşdırma Vaxtı": "Finalization Time",
        "Hesablama Vaxtı": "Calculation Time",
        "Qiymətləndirmə Nəticəsi": "Evaluation Result",
        "Qiymətləndirmə Nəticələri": "Evaluation Results",
        "Başlıq": "Title",
        "Mesaj": "Message",
        "Oxundu": "Read",
        "Keçid": "Redirect",
        "Bildiriş": "Notification",
        "Bildirişlər": "Notifications",
        "Şablon Adı": "Template Name",
        "Mövzu": "Subject",
        "HTML Məzmun": "HTML Content",
        "Mətn Məzmunu": "Text Content",
        "E-poçt Şablonu": "Email Template",
        "E-poçt Şablonları": "Email Templates",
        "Şablon": "Template",
        "Alıcı": "Recipient",
        "Xəta Mesajı": "Error Message",
        "E-poçt Loqu": "Email Log",
        "E-poçt Loqları": "Email Logs",
        "Hesabat Məlumatları": "Report Data",
        "Hesabat": "Report",
        "Hesabatlar": "Reports",
        "Radar Qrafik Məlumatı": "Radar Chart Data",
        "Radar Qrafik Məlumatları": "Radar Chart Data",
        "Hesabat Növü": "Report Type",
        "Tələb edən": "Requester",
        "Hesabat Faylı": "Report File",
        "Task ID, parameterlər və s.": "Task ID, parameters, etc.",
        "Tamamlanma Tarixi": "Completion Date",
        "Hesabat Yaratma Loqu": "Report Creation Log",
        "Hesabat Yaratma Loqları": "Report Creation Logs",
        "Prioritet": "Priority",
        "Təyin Edildi": "Assigned",
        "Həll Tarixi": "Resolution Date",
        "Dəstək Sorğusu": "Support Request",
        "Dəstək Sorğuları": "Support Requests",
        "Sorğu": "Request",
        "Daxili Qeyd": "Internal Note",
        "Yalnız support komandası üçün görünən": "Visible only to support team",
        "Sorğu Şərhi": "Request Comment",
        "Sorğu Şərhləri": "Request Comments",
        "Təlim və İnkişaf": "Training and Development",
        "Təlim Adı": "Training Name",
        "Təlim Növü": "Training Type",
        "Onlayn": "Online",
        "Çatdırılma Metodu": "Delivery Method",
        "Link": "Link",
        "Onlayn təlim linki və ya əlavə məlumat": "Online training link or additional information",
        "Çətinlik Səviyyəsi": "Difficulty Level",
        "Müddət (saat)": "Duration (hours)",
        "Təlimin təxmini müddəti saat olaraq": "Estimated duration of training in hours",
        "Dil": "Language",
        "Əlaqəli Kompetensiyalar": "Related Competencies",
        "Bu təlimin inkişaf etdirdiyi kompetensiyalar": "Competencies developed by this training",
        "Təlim Təminatçısı": "Training Provider",
        "Təlimatçı/Mütəxəssis": "Instructor/Specialist",
        "Qiymət": "Price",
        "Təlimin dəyəri (manat)": "Value of training (manat)",
        "Maksimum İştirakçı": "Maximum Participants",
        "Müəyyən vəzifələr üçün məcburi təlim": "Mandatory training for specific positions",
        "Təlim Resursu": "Training Resource",
        "Təlim Resursları": "Training Resources",
        "Təyin Edən": "Assigned By",
        "Təyin Növü": "Assignment Type",
        "Əlaqəli İnkişaf Məqsədi": "Related Development Goal",
        "Son Tarix": "Deadline",
        "Proqres (%)": "Progress (%)",
        "0-100 arası": "0-100 range",
        "Tamamlanma Qeydi": "Completion Note",
        "İstifadəçi Rəyi": "User Feedback",
        "Reytinq": "Rating",
        "1-5 ulduz arası qiymətləndirmə": "1-5 star rating",
        "Sertifikat Linki": "Certificate Link",
        "İstifadəçi Təlimi": "User Training",
        "İstifadəçi Təlimləri": "User Trainings",
        "Welcome": "Welcome",
        "Here's what's happening today": "Here's what's happening today",
        "Print": "Print",
        "Pending": "Pending",
        "Completed": "Completed",
        "Avg Score": "Avg Score",
        "My Active Tasks": "My Active Tasks",
        "Top 3 critical functions for your attention": "Top 3 critical functions for your attention",
        "Pending Evaluations": "Pending Evaluations",
        "Awaiting your response": "Awaiting your response",
        "Upcoming Trainings": "Upcoming Trainings",
        "Due within 7 days": "Due within 7 days",
        "Skills Pending Approval": "Skills Pending Approval",
        "Requires your approval": "Requires your approval",
        "Active Development Goals": "Active Development Goals",
        "In progress": "In progress",
        "My Assignments": "My Assignments",
        "View All": "View All",
        "Person": "Person",
        "Campaign": "Campaign",
        "Type": "Type",
        "Action": "Action",
        "Fill": "Fill",
        "No pending evaluations": "No pending evaluations",
        "Quick Actions": "Quick Actions",
        "Goals": "Goals",
        "No notifications": "No notifications",
        "Performance Trend": "Performance Trend",
        "Score Distribution": "Score Distribution",
        "Initial Setup Wizard": "Initial Setup Wizard",
        "First Time Setup": "First Time Setup",
        "Setup Wizard": "Setup Wizard",
        "Let's configure your Q360 system in a few simple steps": "Let's configure your Q360 system in a few simple steps",
        "Setup Progress": "Setup Progress",
        "Step": "Step",
        "Organization Information": "Organization Information",
        "Enter your organization details": "Enter your organization details",
        "Organization Name": "Organization Name",
        "Enter organization name": "Enter organization name",
        "Industry": "Industry",
        "Select industry": "Select industry",
        "Technology": "Technology",
        "Finance": "Finance",
        "Healthcare": "Healthcare",
        "Education": "Education",
        "Other": "Other",
        "Department Structure": "Department Structure",
        "Add your main departments": "Add your main departments",
        "Department name": "Department name",
        "Add Department": "Add Department",
        "User Import": "User Import",
        "Import users or add them manually later": "Import users or add them manually later",
        "Upload CSV file or skip for now": "Upload CSV file or skip for now",
        "Choose File": "Choose File",
        "Competency Framework": "Competency Framework",
        "Select a competency framework template": "Select a competency framework template",
        "Basic Framework": "Basic Framework",
        "Essential competencies for most organizations": "Essential competencies for most organizations",
        "Advanced Framework": "Advanced Framework",
        "Comprehensive competencies with technical skills": "Comprehensive competencies with technical skills",
        "Review & Confirm": "Review & Confirm",
        "Review your setup before completing": "Review your setup before completing",
        "Organization": "Organization",
        "Not set": "Not set",
        "departments": "departments",
        "Not selected": "Not selected",
        "Back": "Back",
        "Skip Setup": "Skip Setup",
        "Next": "Next",
        "Complete Setup": "Complete Setup",
        "Review": "Review",
        "Setup completed successfully!": "Setup completed successfully!",
        "Setup failed. Please try again.": "Setup failed. Please try again.",
        "Manage system users": "Manage system users",
        "Refresh": "Refresh",
        "Total Users": "Total Users",
        "User List": "User List",
        "of": "of",
        "User": "User",
        "Email": "Email",
        "Department": "Department",
        "Role": "Role",
        "Active": "Active",
        "Inactive": "Inactive",
        "No users found": "No users found",
        "Load More": "Load More",
        "All users loaded": "All users loaded",
        "Failed to load users": "Failed to load users",
        "Security Dashboard": "Security Dashboard",
        "Total Login Failures (7 days)": "Total Login Failures (7 days)",
        "Failures by Day": "Failures by Day",
        "Top Failed IPs": "Top Failed IPs",
        "IP Address": "IP Address",
        "Failures": "Failures",
        "No data available": "No data available",
        "Top Failed Users": "Top Failed Users",
        "Username": "Username",
        "Recent Failures": "Recent Failures",
        "Time": "Time",
        "Login Failures": "Login Failures",
        "360° Performance Evaluation System": "360° Performance Evaluation System",
        "Professional 360° Performance Evaluation System": "Professional 360° Performance Evaluation System",
        "Quick Links": "Quick Links",
        "Help": "Help",
        "Resources": "Resources",
        "Privacy Policy": "Privacy Policy",
        "Terms of Service": "Terms of Service",
        "Contact": "Contact",
        "All rights reserved.": "All rights reserved.",
        "Home": "Home",
        "Skills": "Skills",
        "Send Feedback": "Send Feedback",
        "Profile": "Profile",
        "Settings": "Settings",
        "Security": "Security",
        "Admin Panel": "Admin Panel",
        "Logout": "Logout",
        "Login": "Login",
        "My Reports": "My Reports",
        "Team Reports": "Team Reports",
        "Custom Report Builder": "Custom Report Builder",
        "Skills & Training": "Skills & Training",
        "My Skills": "My Skills",
        "Skill Gap Analysis": "Skill Gap Analysis",
        "My Trainings": "My Trainings",
        "My Certificates": "My Certificates",
        "Training Catalog": "Training Catalog",
        "Development": "Development",
        "My Goals": "My Goals",
        "Goal Suggestions": "Goal Suggestions",
        "My Competency Gaps": "My Competency Gaps",
        "HR Tools": "HR Tools",
        "Talent Matrix": "Talent Matrix",
        "Succession Planning": "Succession Planning",
        "Gap Analysis": "Gap Analysis",
        "Users Management": "Users Management",
        "Training Programs": "Training Programs",
        "Feedback": "Feedback",
        "Received Feedback": "Received Feedback",
        "Recognition Feed": "Recognition Feed",
        "My Feedback Bank": "My Feedback Bank",
        "Proactive Suggestions": "Proactive Suggestions",
        "Inbox": "Inbox",
        "Bulk Notifications": "Bulk Notifications",
        "Templates": "Templates",
        "System": "System",
        "Question Library": "Question Library",
        "RBAC Matrix": "RBAC Matrix",
        "Version": "Version",
        "Competency Details": "Competency Details",
        "Competency Library": "Competency Library",
        "Explore requirements, related positions, and proficiency trends.": "Explore requirements, related positions, and proficiency trends.",
        "Back to list": "Back to list",
        "Overview": "Overview",
        "Competency": "Competency",
        "No description provided yet.": "No description provided yet.",
        "Created": "Created",
        "Last Updated": "Last Updated",
        "Positions": "Positions",
        "Roles depending on this competency": "Roles depending on this competency",
        "Position": "Position",
        "Weight": "Weight",
        "Required Level": "Required Level",
        "No linked positions yet.": "No linked positions yet.",
        "People": "People",
        "Users practicing this competency": "Users practicing this competency",
        "Level": "Level",
        "Score": "Score",
        "No user skills recorded yet.": "No user skills recorded yet.",
        "Snapshot": "Snapshot",
        "Roles referencing this competency": "Roles referencing this competency",
        "Professionals": "Professionals",
        "Active skill holders": "Active skill holders",
        "Average Score": "Average Score",
        "N/A": "N/A"
    }
    
    return translations.get(azeri_text, azeri_text)


def process_po_file(file_path):
    """Process the .po file to fill ALL empty msgstr entries, including multiline ones."""
    
    with open(file_path, 'r', encoding='utf-8') as f:
        content = f.read()
    
    # First, let's handle all single-line msgid/msgstr pairs with empty msgstr
    # Pattern matches: msgid "text" followed by msgstr ""
    single_pattern = r'(msgid\s+"(.+?)"\s*\nmsgstr\s+"")'
    
    def replace_empty_msgstr(match):
        full_match = match.group(1)
        msgid_text = match.group(2)
        
        # Only replace if msgstr is empty
        if 'msgstr ""' in full_match:
            english_translation = get_english_translation(msgid_text)
            return f'msgid "{msgid_text}"\nmsgstr "{english_translation}"'
        
        return full_match
    
    updated_content = re.sub(single_pattern, replace_empty_msgstr, content)
    
    # Now handle multiline msgid entries that have empty msgstr
    # These have the pattern: msgid "" followed by continuation lines, then msgstr ""
    multiline_pattern = r'(msgid\s+""\s*\n(?:^"[^"]*"\s*\n)+msgstr\s+"")'
    
    def replace_empty_multiline_msgstr(match):
        full_match = match.group(1)
        
        # Extract the msgid content from the match
        lines = full_match.split('\n')
        msgid_text = ""
        
        # First line is "msgid """, skip it
        # Next lines are the actual msgid content like "actual text here"
        for line in lines[1:]:  # Skip first line which is "msgid """" 
            line = line.strip()
            if line.startswith('"') and line.endswith('"') and line != '""' and not line.startswith('msgstr'):
                # Remove the quotes and add to msgid_text
                actual_content = line[1:-1]  # Remove first and last quote
                msgid_text += actual_content
            elif line.startswith('msgstr'):
                # Reached the msgstr line, stop processing
                break
        
        # Only replace if we found a valid msgid and empty msgstr
        if msgid_text and 'msgstr ""' in full_match:
            english_translation = get_english_translation(msgid_text)
            # Properly reconstruct the multiline msgid with the new translation
            result = 'msgid ""\n'
            # Add back the original msgid content lines
            for line in lines[1:]:  # Skip first line which is "msgid """" 
                line = line.strip()
                if line.startswith('"') and line.endswith('"') and line != '""' and not line.startswith('msgstr'):
                    result += f'"{line[1:-1]}"\n'
                elif line.startswith('msgstr'):
                    break
            result += f'msgstr "{english_translation}"'
            return result
        
        return full_match
    
    # Apply the multiline pattern replacement
    updated_content = re.sub(multiline_pattern, replace_empty_multiline_msgstr, updated_content, flags=re.MULTILINE)
    
    # Write the updated content back to the file
    with open(file_path, 'w', encoding='utf-8') as f:
        f.write(updated_content)
    
    print(f"Updated {file_path} with English translations for empty msgstr entries.")
    
    # Count remaining empty msgstr entries (excluding header at line 6 which should be empty)
    remaining_empty = len(re.findall(r'\nmsgid\s+"[^"]+"\s*\nmsgstr\s+""', updated_content))
    print(f"Remaining single-line empty msgstr entries: {remaining_empty}")
    
    # Check for multiline entries
    multiline_empty = len(re.findall(r'\nmsgid\s+""\s*\n(?:^"[^"]*"\s*\n)+msgstr\s+""', updated_content, re.MULTILINE))
    print(f"Remaining multiline empty msgstr entries: {multiline_empty}")


if __name__ == "__main__":
    po_file_path = "C:/lahiyeler/q360/q360_project/locale/az/LC_MESSAGES/django.po"
    process_po_file(po_file_path)